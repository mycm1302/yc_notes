# 위상최적화

> 상위: [[최적화설계]]

주어진 설계 영역 내에서 재료의 최적 분포를 찾는 설계 방법입니다. 간단히 말해 "어디에 재료를 두고, 어디에 구멍을 뚫을지"를 컴퓨터가 자동으로 결정해주는 기술입니다.

## 🔬 기본 개념

### 정의와 원리
위상최적화는 **"구조의 예술은 구멍을 어디에 둘 것인가"**(Robert Le Ricolais)라는 명언처럼, 구조물에서 불필요한 재료를 제거하여 최적의 형태를 만드는 방법입니다.

**전통적 설계 vs 위상최적화:**
- **전통적 방법**: 설계자가 경험과 직감으로 형태 결정 → 해석 → 수정 반복
- **위상최적화**: 컴퓨터가 수학적으로 최적 형태 자동 생성

**핵심 아이디어:**
1. 설계 영역을 작은 격자(픽셀)로 나눔
2. 각 격자에 재료 밀도 값 할당 (0=빈공간, 1=재료)
3. 목표(예: 최대 강성)에 맞게 밀도 분포 최적화
4. 최종적으로 0과 1로만 구성된 최적 구조 획득

### 장점과 특징
- **혁신적 구조**: 인간이 생각하지 못한 형태 창출
- **경량화**: 동일 성능에서 최소 재료 사용
- **자동화**: 설계자 개입 없이 최적해 도출
- **객관성**: 수학적 근거에 기반한 설계

### 한계점
- **제조성**: 복잡한 형태로 가공이 어려울 수 있음
- **계산비용**: 고해상도 해석 시 시간 소요
- **국소해**: 전역 최적해 보장 어려움

---

## 🧮 수학적 모델링

### 기본 최적화 문제 정식화

가장 기본적인 컴플라이언스 최소화 문제:

```
최소화: c(ρ) = U^T K U = ∑ ρₑᵖ uₑ^T k₀ uₑ
제약조건: 
  V(ρ) = ∑ ρₑ vₑ ≤ f·V₀  (체적 제약)
  K U = F  (평형 방정식)
  0 ≤ ρₑ ≤ 1  (밀도 범위)
```

**기호 설명:**
- `c`: 컴플라이언스 (구조물의 유연성, 작을수록 강함)
- `ρₑ`: e번째 요소의 재료 밀도 (0~1)
- `U, uₑ`: 전체/요소 변위 벡터
- `K, k₀`: 전체/요소 강성 행렬
- `F`: 하중 벡터
- `V₀`: 전체 설계 영역 체적
- `f`: 허용 체적비 (예: 0.3 = 30%)
- `p`: 벌점 지수 (보통 3)

### SIMP 방법 (Solid Isotropic Material with Penalization)

**핵심 아이디어**: 중간 밀도(0.5 등)를 불리하게 만들어 0 또는 1로 수렴시킴

**재료 모델:**
```
E(ρ) = Eₘᵢₙ + ρᵖ(E₀ - Eₘᵢₙ)
```

**매개변수 설명:**
- `E₀`: 실제 재료의 탄성계수
- `Eₘᵢₙ`: 빈 공간의 작은 탄성계수 (수치적 안정성)
- `p`: 벌점 지수 (3~4 권장)

**p값의 영향:**
- p=1: 선형 보간 (중간 밀도 많이 남음)
- p=3: 적절한 벌점화 (실용적)
- p→∞: 0-1 설계 (수치적 불안정)

### 필터링 기법

**체크보드 패턴 문제**: 인접한 요소가 번갈아 0-1로 배치되는 비현실적 결과

**해결책 - 밀도 필터:**
```
ρ̃ₑ = (∑ wₑᵢ ρᵢ) / (∑ wₑᵢ)
wₑᵢ = max(0, rₘᵢₙ - dist(e,i))
```

**필터 효과:**
- 급격한 밀도 변화 방지
- 제조 가능한 최소 두께 확보
- 메시 의존성 감소

---

## 📊 실제 설계 예제

### 예제 1: 단순 캔틸레버 보

**설정:**
- 길이 60mm, 높이 20mm 직사각형 영역
- 왼쪽 끝 고정, 오른쪽 끝 하단에 하중
- 체적비 50% 제약

**결과 해석:**
1. **하중 경로**: 하중에서 지지점까지 최단 경로 형성
2. **트러스 형태**: 압축재와 인장재가 명확히 구분
3. **구멍 위치**: 응력이 낮은 부분에 자연스럽게 형성

### 예제 2: MBB 보 (Middle-loaded Beam)

**설정:**
- 중앙 하중, 양단 지지
- 대칭 조건 활용으로 계산량 절반

**특징:**
- 대칭성으로 인한 명확한 구조
- 전통적 트러스와 유사한 형태
- 제조성이 좋은 결과

---

## 🛠️ 실습 가이드

### MATLAB 99줄 코드 실습

**유명한 Sigmund의 99줄 코드**를 단계별로 이해해보겠습니다:

**1단계: 초기화**
```matlab
function top99(nelx,nely,volfrac,penal,rmin)
% nelx, nely: x,y 방향 요소 수
% volfrac: 체적비 (0.5 = 50%)
% penal: 벌점 지수 (3.0)
% rmin: 필터 반지름 (1.5)
```

**2단계: 유한요소 준비**
```matlab
% 재료 특성
E0 = 1;      % 재료 탄성계수
Emin = 1e-9; % 빈 공간 탄성계수
nu = 0.3;    % 포아송비

% 요소 강성행렬 생성
KE = lk; % 평면응력 요소 강성행렬
```

**3단계: 하중 및 경계조건**
```matlab
% 자유도 정의
F = sparse(2*(nely+1)*(nelx+1),1);
U = zeros(2*(nely+1)*(nelx+1),1);

% 하중 적용 (예: 오른쪽 하단)
F(2,1) = -1;

% 고정 지지 (예: 왼쪽 전체)
fixeddofs = union([1:2:2*(nely+1)],[2:2:2*(nely+1)]);
alldofs = [1:2*(nely+1)*(nelx+1)];
freedofs = setdiff(alldofs,fixeddofs);
```

**4단계: 최적화 루프**
```matlab
x = repmat(volfrac,nely,nelx); % 초기 밀도 분포
loop = 0; change = 1;

while change > 0.01
    loop = loop + 1;
    xold = x;
    
    % 1. 유한요소 해석
    % 2. 목적함수 계산
    % 3. 민감도 계산
    % 4. 필터링
    % 5. 설계 업데이트 (OC법)
    
    change = max(max(abs(x-xold)));
    disp([' It.: ' sprintf('%4i',loop) ...
          ' Obj.: ' sprintf('%10.4f',c) ...
          ' Vol.: ' sprintf('%6.3f',sum(sum(x))/(nelx*nely)) ...
          ' ch.: ' sprintf('%6.3f',change )]);
end
```

### 실습 과제

**과제 1: 매개변수 영향 분석**
- 체적비를 30%, 50%, 70%로 변경하여 결과 비교
- 벌점 지수 p를 1, 2, 3으로 변경하여 효과 관찰

**과제 2: 다양한 하중 조건**
- 중앙 집중 하중
- 분포 하중
- 다중 하중점

**과제 3: 경계조건 변경**
- 캔틸레버 → 단순지지
- 고정-고정
- 고정-핀 지지

---

## 📈 고급 주제

### 다물리 최적화

**열-구조 연성 문제:**
```
최소화: w₁·컴플라이언스 + w₂·최대온도
제약조건: 체적, 열전도 방정식, 구조 평형
```

**유체-구조 최적화:**
- 압력 손실 최소화
- 열교환 효율 최대화
- Navier-Stokes 방정식 제약

### 제조 제약 고려

**오버행 제약 (3D 프린팅):**
```
∂ρ/∂z ≥ -tan(θ_max) ∂ρ/∂x
```
여기서 θ_max는 최대 오버행 각도

**대칭성 제약:**
```
ρ(x,y) = ρ(-x,y)  (y축 대칭)
```

**패턴 반복 제약:**
주기적 경계조건으로 반복 단위셀 설계

---

## 💡 실무 적용 팁

### 설계 프로세스

**1단계: 문제 정의**
- 설계 목표 명확화 (경량화? 강성? 진동?)
- 하중 조건 분석
- 제조 방법 고려

**2단계: 초기 설정**
- 적절한 해상도 선택 (50×30 → 200×120)
- 체적비 설정 (보통 30-50%)
- 필터 반지름 결정

**3단계: 결과 해석**
- 하중 경로 확인
- 응력 집중 위치 점검
- 제조 가능성 검토

**4단계: 후처리**
- CAD 모델링으로 변환
- 세부 치수 결정
- 공차 분석

### 주의사항

**수치적 문제:**
- 메시 의존성: 해상도 증가 시 다른 결과
- 국소해: 초기값에 따른 결과 변화
- 수렴성: 목적함수 변화량 모니터링

**물리적 해석:**
- 중간 밀도 영역: 0.3~0.7은 해석 주의
- 응력 집중: 날카로운 모서리 부분
- 하중 전달: 명확한 경로 존재 확인

---

## 🔧 소프트웨어 도구

### 상용 소프트웨어

**Altair OptiStruct**
- 장점: 다양한 최적화 유형, 제조 제약
- 단점: 고가, 학습 곡선
- 적용: 자동차, 항공기 산업

**ANSYS Topology Optimization**
- 장점: 다물리 연성, ANSYS 생태계
- 단점: 추가 라이선스 필요
- 적용: 전자기기, 구조물

**SolidWorks Simulation**
- 장점: 사용 편의성, CAD 통합
- 단점: 기능 제한적
- 적용: 일반 기계 부품

### 오픈소스/연구용

**TopOpt (MATLAB)**
```matlab
% 기본 사용법
top99(60,20,0.5,3.0,1.5);  % 60×20, 50% 체적비
```

**ToPy (Python)**
```python
import topy
# 설정 파일 기반 실행
```

**FEniCS/dolfin-adjoint**
- 유한요소 + 자동 미분
- 복잡한 형태의 제약조건 처리

---

## 📚 학습 로드맵

### 초급 (1-2개월)
1. **개념 이해**: 위상최적화 원리와 응용
2. **기본 실습**: MATLAB 99줄 코드 실행
3. **매개변수 연구**: 체적비, 벌점지수 영향

### 중급 (3-6개월)
1. **수학적 이해**: SIMP 방법, 민감도 해석
2. **고급 실습**: 다양한 하중/경계조건
3. **소프트웨어**: 상용 도구 사용법

### 고급 (6개월+)
1. **연구 주제**: 제조 제약, 다목적 최적화
2. **구현**: 자체 코드 개발
3. **실무 적용**: 실제 제품 설계

---

**참고문헌:**
- Bendsøe, M.P. & Sigmund, O. (2004). *Topology Optimization: Theory, Methods, and Applications*. Springer.
- Sigmund, O. (2001). A 99 line topology optimization code written in Matlab. *Structural and Multidisciplinary Optimization*, 21(2), 120-127.
- Rozvany, G.I.N. (2009). A critical review of established methods of structural topology optimization. *Structural and Multidisciplinary Optimization*, 37(3), 217-237.