# ê¸°ê³„ì ìŠ¤ìœ„ì¹˜

> ìƒìœ„: [[ì „ìíšŒë¡œì„¤ê³„]]

ë¡œë´‡ ì‹œìŠ¤í…œì˜ ì „ë ¥ ì œì–´ì™€ ì•ˆì „ì„ ìœ„í•œ ë¦´ë ˆì´ ë° ê¸°ê³„ì  ìŠ¤ìœ„ì¹˜ íšŒë¡œì…ë‹ˆë‹¤.

## ğŸ”„ ë¦´ë ˆì´ êµ¬ë™ íšŒë¡œ

### ê¸°ë³¸ ë¦´ë ˆì´ ì œì–´
```
MCU GPIO â”€â”€â”€ ì €í•­ â”€â”€â”€ íŠ¸ëœì§€ìŠ¤í„° ë² ì´ìŠ¤
                        â”‚
                    ë¦´ë ˆì´ ì½”ì¼
                        â”‚
                      ë‹¤ì´ì˜¤ë“œ (ì—­ì „ì•• ë³´í˜¸)
                        â”‚
                      GND

ë¦´ë ˆì´ ì„ íƒ:
- 5V ë¦´ë ˆì´: ì¼ë°˜ì ì¸ ë¡œì§ ì œì–´ìš©
- 12V/24V ë¦´ë ˆì´: ê³ ì „ë ¥ ë¶€í•˜ ì œì–´ìš©
```

### Arduino ë¦´ë ˆì´ ì œì–´
```cpp
// ë‹¨ìˆœ ë¦´ë ˆì´ ëª¨ë“ˆ ì œì–´
#define RELAY_PIN 7

void setup() {
    pinMode(RELAY_PIN, OUTPUT);
    digitalWrite(RELAY_PIN, LOW);  // ë¦´ë ˆì´ OFF
}

void controlRelay(bool state) {
    digitalWrite(RELAY_PIN, state ? HIGH : LOW);
    delay(10);  // ë°”ìš´ì‹± ë°©ì§€
}

// ëª¨í„° ì „ì› ì œì–´ ì˜ˆì‹œ
void motorPowerControl(bool enable) {
    if(enable) {
        digitalWrite(RELAY_PIN, HIGH);  // ëª¨í„° ì „ì› ON
        delay(100);  // ì „ì› ì•ˆì •í™” ëŒ€ê¸°
    } else {
        digitalWrite(RELAY_PIN, LOW);   // ëª¨í„° ì „ì› OFF
    }
}
```
### ê³ ì „ë ¥ ë¦´ë ˆì´ ì œì–´ (STM32)
```cpp
// ì»¨íƒí„° ì œì–´ (ê³ ì „ë ¥ ëª¨í„°ìš©)
void setupContactorControl() {
    // GPIO ì¶œë ¥ ì„¤ì •
    GPIO_InitTypeDef GPIO_InitStruct = {0};
    GPIO_InitStruct.Pin = GPIO_PIN_8;
    GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
    GPIO_InitStruct.Pull = GPIO_NOPULL;
    HAL_GPIO_Init(GPIOA, &GPIO_InitStruct);
}

void controlMainContactor(bool enable) {
    if(enable) {
        // í”„ë¦¬ì°¨ì§€ ë¨¼ì € (ì„œì„œíˆ ì „ì•• ìƒìŠ¹)
        HAL_GPIO_WritePin(PRECHARGE_GPIO_Port, PRECHARGE_Pin, GPIO_PIN_SET);
        HAL_Delay(500);  // 500ms í”„ë¦¬ì°¨ì§€
        
        // ë©”ì¸ ì»¨íƒí„° ON
        HAL_GPIO_WritePin(MAIN_CONTACTOR_GPIO_Port, MAIN_CONTACTOR_Pin, GPIO_PIN_SET);
        HAL_Delay(100);
        
        // í”„ë¦¬ì°¨ì§€ OFF
        HAL_GPIO_WritePin(PRECHARGE_GPIO_Port, PRECHARGE_Pin, GPIO_PIN_RESET);
    } else {
        // ì¦‰ì‹œ ì°¨ë‹¨
        HAL_GPIO_WritePin(MAIN_CONTACTOR_GPIO_Port, MAIN_CONTACTOR_Pin, GPIO_PIN_RESET);
    }
}
```

## ğŸ›¡ï¸ ì•ˆì „ ì‹œìŠ¤í…œ

### Emergency Stop íšŒë¡œ
```cpp
// ë¹„ìƒì •ì§€ ì‹œìŠ¤í…œ (ESP32)
#define ESTOP_BUTTON 34     // ë¹„ìƒì •ì§€ ë²„íŠ¼ (í’€ë‹¤ìš´)
#define SAFETY_RELAY 25     // ì•ˆì „ ë¦´ë ˆì´ ì¶œë ¥
#define MOTOR_ENABLE 26     // ëª¨í„° ì¸ì—ì´ë¸”

volatile bool emergencyStop = false;

void IRAM_ATTR estopISR() {
    emergencyStop = true;
    digitalWrite(SAFETY_RELAY, LOW);    // ì¦‰ì‹œ ë¦´ë ˆì´ ì°¨ë‹¨
    digitalWrite(MOTOR_ENABLE, LOW);    // ëª¨í„° ë¹„í™œì„±í™”
}

void setup() {
    pinMode(ESTOP_BUTTON, INPUT_PULLUP);
    pinMode(SAFETY_RELAY, OUTPUT);
    pinMode(MOTOR_ENABLE, OUTPUT);
    
    attachInterrupt(digitalPinToInterrupt(ESTOP_BUTTON), estopISR, FALLING);
}

void checkSafetySystem() {
    if(emergencyStop) {
        Serial.println("EMERGENCY STOP ACTIVATED!");
        // ëª¨ë“  ìœ„í—˜ ìš”ì†Œ ì°¨ë‹¨
        shutdownAllSystems();
        
        // ë¦¬ì…‹ì„ ìœ„í•´ì„œëŠ” ìˆ˜ë™ ì¡°ì¹˜ í•„ìš”
        while(digitalRead(ESTOP_BUTTON) == LOW) {
            delay(100);
        }
        emergencyStop = false;
    }
}
```
### ë¦´ë ˆì´ ì„ íƒ ê°€ì´ë“œ
```
ì ‘ì  ìš©ëŸ‰ì— ë”°ë¥¸ ë¶„ë¥˜:
- ì‹ í˜¸ìš©: 1A ì´í•˜ (ì„¼ì„œ ì‹ í˜¸ ìŠ¤ìœ„ì¹­)
- ì¼ë°˜ìš©: 10A ì´í•˜ (ì¼ë°˜ ë¶€í•˜)  
- ì „ë ¥ìš©: 30A ì´ìƒ (ëª¨í„°, íˆí„° ë“±)

ì½”ì¼ ì „ì••:
- 5V: ë¡œì§ ë ˆë²¨ ì œì–´
- 12V: ìë™ì°¨, ì¼ë°˜ ì‚°ì—…ìš©
- 24V: ì‚°ì—…ìš© í‘œì¤€

ì ‘ì  í˜•íƒœ:
- SPST: ë‹¨ìˆœ ON/OFF
- SPDT: ì „í™˜ ìŠ¤ìœ„ì¹˜
- DPDT: ì–‘ë°©í–¥ ëª¨í„° ì œì–´
```

## ğŸ”§ ì‹¤ë¬´ ì ìš© ì˜ˆì‹œ

### ë¡œë´‡ ì „ì› ì‹œí€€ìŠ¤ ì œì–´
```cpp
// ì „ì› íˆ¬ì… ì‹œí€€ìŠ¤
void powerUpSequence() {
    Serial.println("Starting power sequence...");
    
    // 1. ì œì–´ ì „ì› ë¨¼ì €
    digitalWrite(CONTROL_POWER_RELAY, HIGH);
    delay(100);
    
    // 2. ì„¼ì„œ ì „ì›
    digitalWrite(SENSOR_POWER_RELAY, HIGH);
    delay(200);
    
    // 3. í†µì‹  ëª¨ë“ˆ ì „ì›
    digitalWrite(COMM_POWER_RELAY, HIGH);
    delay(300);
    
    // 4. ë§ˆì§€ë§‰ì— ëª¨í„° ì „ì› (ê°€ì¥ í° ë¶€í•˜)
    digitalWrite(MOTOR_POWER_RELAY, HIGH);
    delay(500);
    
    Serial.println("Power sequence complete");
}

// ì•ˆì „í•œ ì „ì› ì°¨ë‹¨ ì‹œí€€ìŠ¤
void powerDownSequence() {
    Serial.println("Starting shutdown sequence...");
    
    // ì—­ìˆœìœ¼ë¡œ ì°¨ë‹¨
    digitalWrite(MOTOR_POWER_RELAY, LOW);
    delay(100);
    digitalWrite(COMM_POWER_RELAY, LOW);
    delay(100);
    digitalWrite(SENSOR_POWER_RELAY, LOW);
    delay(100);
    digitalWrite(CONTROL_POWER_RELAY, LOW);
    
    Serial.println("Shutdown complete");
}
```

### ë¦´ë ˆì´ ìƒíƒœ ëª¨ë‹ˆí„°ë§
```cpp
// ë¦´ë ˆì´ ì ‘ì  ìƒíƒœ í™•ì¸
bool checkRelayStatus(int feedbackPin) {
    // ë¦´ë ˆì´ ë³´ì¡° ì ‘ì ìœ¼ë¡œ ì‹¤ì œ ìƒíƒœ í™•ì¸
    return digitalRead(feedbackPin) == HIGH;
}

void monitorRelayHealth() {
    static unsigned long lastCheck = 0;
    
    if(millis() - lastCheck > 1000) {  // 1ì´ˆë§ˆë‹¤ ì²´í¬
        if(!checkRelayStatus(MAIN_RELAY_FB)) {
            Serial.println("WARNING: Main relay failure!");
            emergencyShutdown();
        }
        lastCheck = millis();
    }
}
```

---

## ğŸ”— ì—°ê²° ë¬¸ì„œ
- ìƒìœ„: [[ì „ìíšŒë¡œì„¤ê³„]]
- ê´€ë ¨: [[ì „ì›ì‹œìŠ¤í…œ]], [[ëª¨í„°ë“œë¼ì´ë²„]]
- ì‘ìš©: [[ì œì–´ì‹œìŠ¤í…œ]], [[ì‹¤ì‹œê°„ì œì–´]], [[ì•ˆì „ì‹œìŠ¤í…œ]]