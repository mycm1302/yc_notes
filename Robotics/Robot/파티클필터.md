# 파티클필터

> 상위: [[상태추정]]

샘플링 기반으로 비선형, 비가우시안 상태 추정을 수행하는 필터입니다. Sequential Monte Carlo 방법의 일종입니다.

## 🎯 기본 개념

### 파티클 표현
- **파티클**: 가능한 상태를 나타내는 샘플 (가설)
- **가중치**: 각 파티클이 실제 상태일 확률
- **파티클 집합**: {(x_i, w_i), i=1,...,N}
- **확률 분포**: 파티클들로 임의의 확률분포 근사

### 몬테카를로 원리
- **확률 분포 → 샘플**: 연속 확률분포를 이산 샘플로 근사
- **큰 수의 법칙**: 샘플 수가 많을수록 정확한 근사
- **비모수적**: 분포 형태에 대한 가정 없음

## 🔄 파티클 필터 과정

### 1. 예측 단계 (Prediction)
```
각 파티클에 대해:
x_i(k|k-1) = f(x_i(k-1), u(k)) + v_i(k)
```
- 운동 모델로 각 파티클 전파
- 프로세스 노이즈 추가

### 2. 가중치 갱신 (Weight Update)
```
w_i(k) = w_i(k-1) × p(z(k)|x_i(k|k-1))
정규화: w_i(k) = w_i(k) / Σw_j(k)
```
- 관측 우도로 가중치 계산
- 관측과 일치하는 파티클일수록 높은 가중치

### 3. 리샘플링 (Resampling)
```
유효 샘플 수: N_eff = 1 / Σw_i²
N_eff < N_threshold이면 리샘플링 수행
```
- 가중치 기반으로 파티클 재추출
- 높은 가중치 파티클은 복제, 낮은 것은 제거

## 📊 리샘플링 방법

### 체계적 샘플링 (Systematic)
- **균등 간격**: 가중치 누적에서 균등하게 선택
- **낮은 분산**: 가장 많이 사용되는 방법

### 층화 샘플링 (Stratified)
- **구간별 선택**: 각 구간에서 하나씩 선택
- **계산 효율**: 체계적 샘플링과 유사한 성능

### 잔여 샘플링 (Residual)
- **정수부 + 소수부**: 가중치×N의 정수부만큼 확정 복제
- **잔여 처리**: 소수부로 추가 샘플링

## 🤖 로봇공학 응용

### 위치 추정 (Localization)
- **Monte Carlo Localization**: 알려진 지도에서 로봇 위치 추정
- **글로벌 위치**: 초기 위치 모를 때 전역 탐색
- **납치 로봇 문제**: 갑작스런 위치 변화 대응

### FastSLAM
- **SLAM 분해**: 경로 추정 + 랜드마크 매핑으로 분리
- **Rao-Blackwellization**: 일부는 파티클, 일부는 칼만필터
- **계산 효율**: O(M log n), M=파티클수, n=랜드마크수

### 추적 문제
- **다중 물체**: 여러 물체 동시 추적
- **비선형 운동**: 복잡한 운동 패턴 모델링

## 💡 장점과 한계

### 장점
- **비선형/비가우시안**: 임의의 확률분포 표현 가능
- **다중 모드**: 여러 가설 동시 유지
- **강건성**: 이상치나 모델 불일치에 강함
- **병렬화**: 파티클별 독립 계산 가능

### 한계
- **계산 비용**: 충분한 파티클 수 필요
- **차원의 저주**: 고차원에서 샘플 수 지수적 증가
- **퇴화 문제**: 소수 파티클만 높은 가중치
- **샘플 빈곤**: 리샘플링으로 다양성 감소

## 🔧 개선 기법

### 적응적 파티클 수
- **KLD 샘플링**: 쿨백-라이블러 발산 기반
- **동적 조절**: 불확실성에 따라 파티클 수 변경

### 제안 분포 개선
- **중요도 샘플링**: 더 나은 제안 분포 사용
- **보조 파티클 필터**: 다음 관측 고려한 샘플링

### 정규화 기법
- **커널 밀도**: 파티클 주변에 연속 분포 가정
- **가우시안 혼합**: 파티클 클러스터를 가우시안으로 근사

## 🔗 구현 고려사항

### 파티클 수 선택
- **환경 복잡도**: 복잡할수록 더 많은 파티클
- **실시간 제약**: 계산 시간과 정확도 트레이드오프
- **적응적 조절**: 상황에 따라 동적 변경

### 초기화
- **균등 분포**: 위치를 모를 때 전역에 균등 배치
- **가우시안**: 대략적 위치 아는 경우
- **혼합 분포**: 여러 후보 위치

## 🔗 연결 분야
- 상위: [[상태추정]]
- 대안: [[칼만필터]], [[확장칼만필터]]
- 응용: [[SLAM]], [[모바일 로봇]]
- 수학: [[확률론]], [[몬테카를로방법]]
- 구현: [[ROS2]], [[실시간제어]]