# 매니폴드

> 상위: [[선형대수및기하학]]  
> 관련: [[리군론]], [[미분기하학]], [[위상수학]]

로봇의 구성공간(Configuration Space)과 작업공간을 수학적으로 엄밀하게 다루기 위한 매니폴드(Manifold) 이론입니다.

## 🎯 매니폴드의 정의

### 기본 개념
```
매니폴드 M: 국소적으로는 유클리드 공간 ℝⁿ과 같지만
           전역적으로는 다른 구조를 가질 수 있는 공간

차원: n (국소 좌표의 개수)
위상학적 매니폴드: 연속성만 요구
미분가능 매니폴드: 매끄러운 구조 추가
```

### 국소 좌표계
```
차트 (Chart): (U, φ)
U ⊂ M: 열린집합
φ: U → ℝⁿ: 동형사상 (homeomorphism)

좌표계 전환: ψ ∘ φ⁻¹: ℝⁿ → ℝⁿ
매끄러운 매니폴드: 모든 전환이 C∞
```

### 아틀라스 (Atlas)
```
{(Uᵢ, φᵢ)}ᵢ∈I: 차트들의 모음
∪ᵢ Uᵢ = M: 전체 매니폴드 덮음
호환 조건: 매끄러운 좌표 전환
```

## 🤖 로봇공학에서의 매니폴드

### 1. 구성공간 (Configuration Space)
```
Q: 로봇의 모든 가능한 자세들의 집합
dim(Q) = DOF (자유도)

예시:
- 평면 강체: Q = ℝ² × S¹ (위치 + 방향)
- 구형 진자: Q = S² (구면)
- n-링크 로봇팔: Q = (S¹)ⁿ (토러스)
```

### 2. 작업공간 (Task Space)
```
X: 말단장치의 가능한 위치와 방향
일반적으로: X ⊆ SE(3)

제약이 있는 경우:
평면 작업: X ⊆ SE(2)
위치만: X ⊆ ℝ³
방향만: X ⊆ SO(3)
```

### 3. 제약 매니폴드
```
제약 조건: g(q) = 0
제약 매니폴드: M = {q ∈ Q | g(q) = 0}

예시:
- 닫힌 체인 로봇
- 접촉 제약
- 경로 제약
```

## 📐 접선공간과 여접선공간

### 접선공간 (Tangent Space)
```
TₚM: 점 p ∈ M에서의 접선공간
차원: dim(TₚM) = dim(M)

물리적 의미: 가능한 순간 운동 방향들
로봇학: 허용 속도 벡터들의 집합
```

### 접선벡터의 표현
```
곡선을 통한 정의:
γ(t): (-ε, ε) → M, γ(0) = p
접선벡터: γ'(0) = d/dt γ(t)|_{t=0}

국소 좌표: v = vⁱ ∂/∂xⁱ|ₚ
```

### 여접선공간 (Cotangent Space)
```
T*ₚM: TₚM의 쌍대공간
원소: 선형함수 α: TₚM → ℝ

미분형식: df = ∂f/∂xⁱ dxⁱ
기저: {dx¹, dx², ..., dxⁿ}
```

## 🔄 매니폴드 사이의 사상

### 매끄러운 사상
```
f: M → N (M과 N은 매니폴드)
매끄러운 조건: 국소 좌표에서 C∞

예시:
순기구학: f: Q → SE(3)
투영 사상: π: ℝⁿ⁺¹\{0} → ℝPⁿ
```

### 미분 사상 (Pushforward)
```
f*: TₚM → T_{f(p)}N
(f*v)(g) = v(g ∘ f)

야코비안 행렬: Df = ∂fⁱ/∂xʲ
로봇학: 자코비안 J = Df
```

### 당김 사상 (Pullback)
```
f*: T*_{f(p)}N → T*ₚM
(f*α)(v) = α(f*v)

응용: 외력을 관절 토크로 변환
```

## 🎯 특수한 매니폴드들

### 1. 리 군 (Lie Group)
```
군 구조 + 매니폴드 구조
SO(3): 3차원 컴팩트 리 군
SE(3): 6차원 비컴팩트 리 군
```

### 2. 구면 (Sphere)
```
Sⁿ = {x ∈ ℝⁿ⁺¹ | ||x|| = 1}
S²: 구형 관절의 구성공간
차원: n, 유클리드 공간 차원: n+1
```

### 3. 토러스 (Torus)
```
Tⁿ = (S¹)ⁿ
n개 회전 관절을 가진 로봇팔
주기적 경계 조건
```

### 4. 실사영공간 (Real Projective Space)
```
ℝPⁿ = Sⁿ / {±1}
SO(3) ≅ ℝP³
회전의 쌍대 표현 문제
```

### 5. 그래스만 다양체 (Grassmannian)
```
Gr(k,n): ℝⁿ의 k차원 부분공간들
로봇의 작업 부공간 분석
```

## 🔧 미분기하학적 구조

### 리만 계량 (Riemannian Metric)
```
g: TM × TM → ℝ (이중선형, 대칭, 양정치)
국소 표현: gᵢⱼ = g(∂/∂xⁱ, ∂/∂xʲ)

물리적 의미: 
- 거리 측정
- 에너지 정의
- 관성 텐서
```

### 접속 (Connection)
```
∇: 벡터장의 공변미분
토션 없는 접속: 리만 접속

응용: 병렬 운송, 측지선
로봇학: 동역학 방정식의 기하학적 해석
```

### 곡률 (Curvature)
```
리만 곡률 텐서: R(X,Y)Z
단면 곡률: K(X,Y)
리치 곡률: Ric(X,Y)
스칼라 곡률: R

로봇학 응용: 경로 계획의 최적성
```

## 🚀 로봇공학 응용

### 1. 운동 계획
```
매니폴드 상의 경로:
γ: [0,1] → M
최적 경로: 측지선
장애물 회피: 구속 매니폴드
```

### 2. 제어 이론
```
제어 시스템: ẋ = f(x,u)
x ∈ M: 상태 매니폴드
제어가능성: 접근가능 집합
```

### 3. 센서 융합
```
센서 데이터: 매니폴드 상의 관측
베이지안 필터링: 확률분포의 진화
파티클 필터: 샘플 기반 근사
```

### 4. 로봇 학습
```
정책 공간: 매니폴드 구조
자연 정책 기울기: 접선공간에서의 최적화
강화학습: 매니폴드 상의 탐색
```

## 📊 계산 방법

### 1. 지수 좌표
```
매니폴드의 국소 매개화:
exp_p: T_p M → M
측지선: γ(t) = exp_p(tv)
```

### 2. 레트랙션 (Retraction)
```
R_p: T_p M → M
R_p(0) = p
DR_p(0) = Id

지수사상의 근사:
- 1차: R_p(v) = p + v
- 2차: 더 정확한 근사
```

### 3. 벡터 운송
```
T_{v→w}: T_p M → T_q M
병렬 운송의 근사
최적화에서 탐색 방향 업데이트
```

## 🎯 수치적 최적화

### 매니폴드 최적화
```
문제: min_{x∈M} f(x)
제약 조건: x ∈ M

기본 아이디어:
1. 접선공간에서 탐색 방향 계산
2. 레트랙션으로 매니폴드에 투영
3. 반복
```

### 리만 경사하강법
```
반복 공식:
x_{k+1} = R_{x_k}(-α_k grad f(x_k))

grad f: 리만 기울기
R: 레트랙션 사상
α_k: 스텝 크기
```

### 응용 예시
```
1. 포즈 그래프 SLAM
2. 주성분 분석 (PCA)
3. 로봇 캘리브레이션
4. 행렬 완성 문제
```

## 🔧 구현 도구

### MATLAB
```matlab
% Manopt 툴박스
problem.M = spherefactory(3);  % 구면 매니폴드
problem.cost = @(x) costfunction(x);
problem.grad = @(x) gradient(x);
x = trustregions(problem);
```

### Python
```python
# PyManopt 라이브러리
import pymanopt
from pymanopt.manifolds import Sphere
from pymanopt.solvers import SteepestDescent

manifold = Sphere(3)
problem = pymanopt.Problem(manifold, cost, egrad=egrad)
solver = SteepestDescent()
result = solver.solve(problem)
```

### 특수 매니폴드 구현
```python
class SO3Manifold:
    def exp(self, x, v):
        """지수 사상"""
        return x @ scipy.linalg.expm(skew(v))
    
    def log(self, x, y):
        """로그 사상"""
        return vee(scipy.linalg.logm(x.T @ y))
    
    def inner(self, x, u, v):
        """내적"""
        return np.trace(u.T @ v)
    
    def proj(self, x, v):
        """접선공간으로 투영"""
        return v - x @ skew_symmetric_part(x.T @ v)
```

## 🎯 고급 주제

### 1. 파이버 번들 (Fiber Bundle)
```
π: E → M (전체공간 → 기저공간)
각 점에서 파이버: π^{-1}(p)

로봇학: 구성-작업 공간 관계
```

### 2. 특성 클래스
```
위상적 불변량: 매니폴드의 전역 성질
오일러 특성수: χ(M)
폰트랴긴 클래스: 실 매니폴드
```

### 3. 드람 코호몰로지
```
미분형식의 정확성과 닫힌성
베티 수: bᵏ = dim Hᵏ_{dR}(M)
```

## 🎯 학습 로드맵

1. **위상수학 기초** (3-4주)
   - 위상공간과 연속성
   - 컴팩트성과 연결성

2. **매니폴드 이론** (4-6주)
   - 국소 좌표와 아틀라스
   - 접선공간과 미분사상

3. **리만 기하학** (4-5주)
   - 계량과 접속
   - 측지선과 곡률

4. **로봇 응용** (3-4주)
   - 구성공간 분석
   - 매니폴드 최적화

5. **고급 주제** (선택, 4-6주)
   - 특성 클래스와 코호몰로지
   - 파이버 번들 이론

---
*참고: Introduction to Smooth Manifolds (Lee), Riemannian Manifolds (Lee), Optimization Algorithms on Matrix Manifolds (Absil), Geometric Control Theory (Bullo & Lewis)*