# 순기구학

> 상위: [[위치기구학]]
>
> 레퍼런스:
> - **Modern Robotics** - Lynch & Park (2017) - Chapter 4.1
> - **Introduction to Robotics** - Craig (2005) - Chapter 3
> - **Wikipedia - Denavit-Hartenberg parameters** (2025년 8월)
> - **Robotics Unveiled - Forward Kinematics using DH Parameters** (2024년 5월)
> - **Robotiq - How to Calculate Forward Kinematics** (2023년)

주어진 관절 변수로부터 말단효과기의 위치와 자세를 계산하는 기구학 문제입니다.

## 🎯 기본 정의

### 순기구학 문제
관절 공간(joint space)에서 작업 공간(task space)으로의 변환:
```
T₀ⁿ = f(θ₁, θ₂, ..., θₙ)
```

여기서:
- **θᵢ**: i번째 관절의 관절 변수
- **T₀ⁿ**: 기준 좌표계에서 말단효과기까지의 동차변환행렬
- **n**: 관절의 개수

### 문제의 특징
- **단일해**: 주어진 관절각에 대해 유일한 말단 자세
- **비선형**: 삼각함수로 인한 비선형 관계
- **연쇄 변환**: 순차적인 좌표계 변환의 곱

---

## 🔧 Denavit-Hartenberg (DH) 규약

### DH 규약의 배경
Jacques Denavit과 Richard Hartenberg가 1955년에 제안한 표준화된 좌표계 설정 방법:
- **목적**: 연쇄 기구학 해석의 체계화
- **장점**: 4개 매개변수로 인접한 링크 간 관계 완전 기술
- **표준화**: 로봇공학에서 가장 널리 사용되는 규약

### DH 매개변수 정의
인접한 두 링크 사이의 관계를 4개 매개변수로 표현:

1. **θᵢ (Joint angle)**: Zᵢ₋₁축 주위의 회전각
2. **dᵢ (Link offset)**: Zᵢ₋₁축을 따라 평행이동 거리  
3. **aᵢ (Link length)**: Xᵢ축을 따라 평행이동 거리
4. **αᵢ (Link twist)**: Xᵢ축 주위의 비틀림각

### DH 좌표계 설정 규칙

#### 규칙 1: Z축 설정
```
Zᵢ축: (i+1)번째 관절의 축과 일치
- 회전관절: 회전축 방향
- 직진관절: 슬라이딩 방향
```

#### 규칙 2: X축 설정
```
Xᵢ축: Zᵢ₋₁과 Zᵢ를 잇는 공통법선 방향
- 교차하는 경우: 교점에서 수직 방향
- 평행한 경우: 임의의 수직 방향
```

#### 규칙 3: Y축 설정
```
Yᵢ축: 오른손 법칙에 의해 결정 (Yᵢ = Zᵢ × Xᵢ)
```

#### 규칙 4: 원점 설정
```
원점: Xᵢ축과 Zᵢ축의 교점
```

---

## 📊 DH 변환행렬

### 표준 DH 변환
링크 i-1에서 링크 i로의 변환행렬:
```
Tᵢ₋₁ⁱ = Rot(z,θᵢ) × Trans(0,0,dᵢ) × Trans(aᵢ,0,0) × Rot(x,αᵢ)
```

### 변환행렬 형태
```
Tᵢ₋₁ⁱ = [cosθᵢ  -sinθᵢcosαᵢ   sinθᵢsinαᵢ   aᵢcosθᵢ]
        [sinθᵢ   cosθᵢcosαᵢ  -cosθᵢsinαᵢ   aᵢsinθᵢ]
        [  0        sinαᵢ        cosαᵢ        dᵢ   ]
        [  0          0            0          1    ]
```

### 전체 변환행렬
기준 좌표계에서 말단효과기까지:
```
T₀ⁿ = T₀¹ × T₁² × T₂³ × ... × Tₙ₋₁ⁿ
```

---

## 🔄 Modified DH 규약

### 표준 DH와의 차이점
Modified DH (Craig 규약)에서는 좌표계 배치가 다릅니다:
- **좌표계 위치**: 링크 i의 좌표계를 관절 i에 배치
- **변환 순서**: 다른 변환 순서 사용

### Modified DH 변환행렬
```
Tᵢ₋₁ⁱ = Rot(x,αᵢ₋₁) × Trans(aᵢ₋₁,0,0) × Rot(z,θᵢ) × Trans(0,0,dᵢ)
```

```
Tᵢ₋₁ⁱ = [cosθᵢ  -sinθᵢ   0   aᵢ₋₁]
        [sinθᵢcosαᵢ₋₁  cosθᵢcosαᵢ₋₁  -sinαᵢ₋₁  -sinαᵢ₋₁dᵢ]
        [sinθᵢsinαᵢ₋₁  cosθᵢsinαᵢ₋₁   cosαᵢ₋₁   cosαᵢ₋₁dᵢ]
        [    0             0            0          1     ]
```

---

## 💻 계산 과정 및 구현

### Step 1: DH 매개변수 표 작성
로봇의 구조 분석 후 DH 표 작성:
```
Link | θᵢ    | dᵢ   | aᵢ   | αᵢ
-----|-------|------|------|------
  1  | θ₁*   | d₁   | a₁   | α₁
  2  | θ₂*   | d₂   | a₂   | α₂
  3  | θ₃*   | d₃   | a₃   | α₃
 ... | ...   | ...  | ...  | ...

* = 가변 매개변수 (관절 변수)
```

### Step 2: 개별 변환행렬 계산
각 링크에 대한 변환행렬 구성:
```python
import numpy as np

def dh_transform(theta, d, a, alpha):
    """DH 매개변수로부터 변환행렬 생성"""
    ct = np.cos(theta)
    st = np.sin(theta)
    ca = np.cos(alpha)
    sa = np.sin(alpha)
    
    T = np.array([
        [ct, -st*ca,  st*sa, a*ct],
        [st,  ct*ca, -ct*sa, a*st],
        [0,      sa,     ca,    d],
        [0,       0,      0,    1]
    ])
    return T
```

### Step 3: 전체 변환행렬 계산
연쇄 변환행렬의 곱:
```python
def forward_kinematics(dh_params, joint_angles):
    """순기구학 계산"""
    T = np.eye(4)  # 단위행렬로 초기화
    
    for i, (theta, d, a, alpha) in enumerate(dh_params):
        # 관절 변수가 있는 경우 업데이트
        if i < len(joint_angles):
            theta += joint_angles[i]
            
        # 개별 변환행렬 계산 및 곱셈
        Ti = dh_transform(theta, d, a, alpha)
        T = np.dot(T, Ti)
    
    return T
```

---

## 📐 구체적 예제

### 2링크 평면 매니퓰레이터
간단한 2자유도 로봇의 순기구학:

#### DH 매개변수 표
```
Link | θᵢ  | dᵢ | aᵢ | αᵢ
-----|-----|----|----|----
  1  | θ₁  | 0  | L₁ | 0
  2  | θ₂  | 0  | L₂ | 0
```

#### 순기구학 해
```
x = L₁cos(θ₁) + L₂cos(θ₁ + θ₂)
y = L₁sin(θ₁) + L₂sin(θ₁ + θ₂)
φ = θ₁ + θ₂
```

### 6축 관절형 로봇 (예: UR5)
산업용 로봇의 일반적인 DH 매개변수 예시:

#### DH 매개변수 표 (UR5 기준)
```
Link | θᵢ     | dᵢ       | aᵢ        | αᵢ
-----|--------|----------|-----------|--------
  1  | θ₁     | 0.089159 | 0         | π/2
  2  | θ₂     | 0        | -0.42500  | 0
  3  | θ₃     | 0        | -0.39225  | 0
  4  | θ₄     | 0.10915  | 0         | π/2
  5  | θ₅     | 0.09465  | 0         | -π/2
  6  | θ₆     | 0.0823   | 0         | 0
```

---

## ⚠️ 주의사항 및 한계

### DH 규약의 한계

#### 1. 평행축 문제
```
Z축이 평행한 경우:
- 공통법선이 유일하지 않음
- 임의성 발생
- 수치적 불안정성 가능
```

#### 2. 교차축 문제
```
Z축이 교차하는 경우:
- 링크 길이 a = 0
- 특별한 처리 필요
```

### 대안적 접근법

#### 1. 스크류 이론 (Screw Theory)
- **장점**: 더 일반적이고 기하학적 직관성
- **단점**: 수학적 복잡성 증가

#### 2. Hayati-Roberts 규약
- **용도**: 거의 평행한 축에 대한 개선된 처리
- **적용**: 특수한 로봇 구조

#### 3. Product of Exponentials (PoE)
- **장점**: 스크류 축 기반의 직관적 표현
- **특징**: Modern Robotics에서 선호하는 방법

---

## 🔍 검증 및 디버깅

### 순기구학 검증 방법

#### 1. 특별한 자세 확인
```python
# 영점 자세 확인
joint_angles = [0, 0, 0, 0, 0, 0]
T = forward_kinematics(dh_params, joint_angles)
print("영점 자세에서의 말단 위치:", T[:3, 3])
```

#### 2. 물리적 제약 확인
```python
# 작업공간 범위 확인
def check_workspace_limits(T):
    position = T[:3, 3]
    reach = np.linalg.norm(position)
    return reach <= max_reach
```

#### 3. 연속성 확인
```python
# 관절각 변화에 따른 연속성 확인
def check_continuity(dh_params, theta1, theta2, tolerance=1e-6):
    T1 = forward_kinematics(dh_params, theta1)
    T2 = forward_kinematics(dh_params, theta2)
    diff = np.linalg.norm(T1 - T2)
    return diff < tolerance
```

---

## 🎯 응용 분야

### 로봇 제어
- **경로 계획**: 관절 공간에서의 궤적 생성
- **충돌 감지**: 링크 위치 추적을 통한 충돌 회피
- **시각화**: 로봇 상태의 실시간 표시

### 시뮬레이션
- **동역학 해석**: 각 링크의 정확한 위치 필요
- **센서 모델링**: 센서 위치 계산
- **성능 분석**: 작업공간 및 조작성 해석

### 교정 (Calibration)
- **기구학 매개변수 추정**: 실제 로봇과 모델 일치
- **오차 보정**: 제조 공차 및 조립 오차 보상

---

## 🔗 연결 분야
- 상위: [[위치기구학]]
- 기초: [[회전행렬]], [[동차변환]]
- 응용: [[역기구학]], [[궤적계획]]
- 도구: [[DH매개변수]], [[스크류이론]]

---

## 📚 참고문헌
1. Lynch, K.M. & Park, F.C. (2017). *Modern Robotics: Mechanics, Planning, and Control*. Cambridge University Press. Chapter 4.1
2. Craig, J.J. (2005). *Introduction to Robotics: Mechanics and Control* (3rd ed.). Pearson. Chapter 3
3. Wikipedia Contributors. (2025). "Denavit-Hartenberg parameters." *Wikipedia*. Retrieved August 2025
4. Robotics Unveiled. (2024). "Forward Kinematics using the Denavit-Hartenberg Convention." Retrieved May 2024
5. Robotiq. (2023). "How to Calculate a Robot's Forward Kinematics in 5 Easy Steps." Blog Post
6. Denavit, J. & Hartenberg, R.S. (1955). "A kinematic notation for lower-pair mechanisms." *Journal of Applied Mechanics*, 22, 215-221