# 필터회로

> 상위: [[전자회로설계]]

원하지 않는 주파수 성분을 제거하여 신호의 품질을 향상시키는 아날로그 필터 회로 설계입니다.

## 🌊 필터 종류와 특성

### 주파수 응답별 분류
- **저역통과 (LPF)**: 낮은 주파수만 통과, 고주파 노이즈 제거
- **고역통과 (HPF)**: 높은 주파수만 통과, DC 성분/저주파 드리프트 제거  
- **대역통과 (BPF)**: 특정 주파수 대역만 통과
- **대역차단 (BSF/Notch)**: 특정 주파수 대역 제거 (60Hz 노이즈 등)

### 차수별 분류
- **1차 필터**: -20dB/decade 롤오프, 간단한 RC/RL 회로
- **2차 필터**: -40dB/decade 롤오프, Active Filter 주로 사용
- **고차 필터**: 더 급한 롤오프, 복잡한 설계

## 🔧 수동 소자 필터 (RC/LC)

### 1차 RC 저역통과 필터
```
차단주파수: fc = 1/(2πRC)

설계 예시 (1kHz 차단):
R = 1.6kΩ, C = 100nF
fc = 1/(2π × 1600 × 100×10⁻⁹) ≈ 1kHz

실무 적용:
- 로드셀 신호 필터링 (진동 노이즈 제거)
- ADC 앞단 앨리어싱 방지
- PWM 신호 평활화
```

### 1차 RC 고역통과 필터
```
차단주파수: fc = 1/(2πRC)

설계 예시 (10Hz 차단):
C = 1μF, R = 16kΩ
fc = 1/(2π × 16000 × 1×10⁻⁶) ≈ 10Hz

실무 적용:
- DC 성분 제거
- 센서 오프셋 제거
- AC 커플링
```

### LC 필터 (전원 노이즈 제거)
```
차단주파수: fc = 1/(2π√LC)

설계 예시 (스위칭 노이즈 필터):
L = 10μH, C = 1000μF
fc = 1/(2π√(10×10⁻⁶ × 1000×10⁻⁶)) ≈ 1.6kHz

실무 적용:
- DC-DC 컨버터 출력 필터
- 모터 드라이버 전원 필터
- 민감한 아날로그 회로 전원 정제
```

## ⚡ 능동 필터 (Op-Amp 기반)

### Sallen-Key 저역통과 필터 (2차)
```
이득: K = 1 + R4/R3
Q (품질인수) = 1/√2 = 0.707 (Butterworth)
차단주파수: fc = 1/(2π√(R1×R2×C1×C2))

표준 설계 (동일값 사용):
R1 = R2 = R, C1 = C2 = C
fc = 1/(2πRC)

1kHz 필터 설계:
R1 = R2 = 1.6kΩ
C1 = C2 = 100nF
버퍼 증폭기 (K=1) 사용
```

### Multiple Feedback 대역통과 필터
```
중심주파수: f0 = 1/(2πC√(R1×R2))
Q = √(R2/R1) / 2
이득: |A| = R2/(2×R1)

실무 예시 (60Hz 노치 필터):
- Twin-T 노치 필터 구조
- 전원 라인 노이즈 제거용
- Q = 5-10 정도로 설계
```

## 🎯 실무 설계 예시

### 로드셀 신호 필터링 체인
```
로드셀 → 계측증폭기 → 저역통과필터 → ADC
        (INA128)      (1kHz)

필터 설계:
목적: 기계적 진동 노이즈 제거 (>1kHz)
구조: 2차 Sallen-Key LPF
차단주파수: 1kHz
Q: 0.707 (Butterworth, 평탄한 응답)

회로값:
R1 = R2 = 1.6kΩ
C1 = C2 = 100nF
Op-Amp: TL072 (저노이즈)
```

### IMU 신호 디지털 필터
```cpp
// 소프트웨어 상보 필터 (가속도계 + 자이로)
float complementaryFilter(float accel_angle, float gyro_rate, float dt) {
    static float angle = 0;
    
    // 고역통과: 자이로 적분 (단기간 정확)
    angle = 0.98 * (angle + gyro_rate * dt) + 
            0.02 * accel_angle;  // 저역통과: 가속도계 (장기간 안정)
    
    return angle;
}

타임 상수: τ = dt × α/(1-α)
α = 0.98일 때, τ ≈ 1초
```

### 모터 전류 측정 필터
```
홀센서(ACS712) → 저역통과 → ADC

노이즈 소스:
- PWM 스위칭 (20kHz)
- 전자기 간섭
- 전원 리플

필터 설계:
1차 RC LPF: fc = 500Hz
R = 3.2kΩ, C = 100nF

추가 노이즈 대책:
- 페라이트 비드 (EMI 억제)
- 차폐 케이블 사용
- 차동 입력 활용
```

## 📊 필터 설계 도구와 계산

### 전달함수 기반 설계
```
1차 LPF: H(s) = 1/(1 + sRC)
2차 LPF: H(s) = ω0²/(s² + (ω0/Q)s + ω0²)

여기서:
ω0 = 2πfc (각주파수)
Q = 품질인수 (0.707: Butterworth, 1.0: 임계감쇠)
```

### 온라인 계산 도구
- **Filter Pro (TI)**: 능동 필터 설계 툴
- **FilterLab (Microchip)**: 필터 시뮬레이션
- **WEBENCH Filter Designer**: 온라인 설계 도구
- **SPICE 시뮬레이션**: LTspice, NgSpice

## 🛡️ 실무 고려사항

### Op-Amp 선택 기준
```
저노이즈 필터용:
- OPA2277: 초저 오프셋, 정밀 측정
- LT1007: 저노이즈, 고정밀도
- TL072: JFET 입력, 범용

고속 필터용:
- LM6171: 고속 응답
- THS4031: 초고속, 구동 능력 우수
- AD8099: 초고속, RF 대역
```

### 부품 허용오차 영향
```
1% 저항 사용시:
- 차단주파수 오차: ±2% 정도
- Q값 변화로 응답 특성 변함

정밀한 필터:
- 0.1% 정밀 저항 사용
- C0G/NP0 세라믹 커패시터
- 온도 계수 매칭
```

### PCB 레이아웃
```
기생 성분 최소화:
- 커패시터 배치: Op-Amp 가까이
- 그라운드 플레인: 아날로그 전용
- 차폐: 민감한 신호 경로

열 설계:
- 정밀 소자 온도 안정화
- 발열원과 거리 유지
- 기준전압 회로 온도 보상
```

## 🔗 관련 문서
- 상위: [[전자회로설계]]  
- 관련: [[증폭회로]], [[신호조절]]
- 이론: [[ADC]], [[센서인터페이스]]
- 응용: [[상태추정]], [[환경인식]]

---

*필터 설계 시 시뮬레이션을 통한 검증과 프로토타입 테스트를 권장합니다.*