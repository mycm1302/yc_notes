# 통신인터페이스

> 상위: [[전자회로설계]]

로봇 시스템 간 데이터 교환을 위한 각종 통신 방식과 회로 설계입니다.

## 📡 통신 방식 분류

### 거리별 분류
- **온보드**: I2C, SPI (PCB 내부)
- **근거리**: UART, CAN (모듈 간)  
- **원거리**: WiFi, Bluetooth (시스템 간)

### 속도별 분류
- **저속**: I2C (400kHz), CAN (1Mbps)
- **중속**: UART (115kbps), WiFi (54Mbps)
- **고속**: SPI (수십MHz), 이더넷 (100Mbps)

## 🔌 주요 인터페이스

### I2C (Inter-Integrated Circuit)
```
특징: 2선식 (SDA, SCL), 마스터-슬레이브
회로: 4.7kΩ Pull-up 저항 필요
용도: 센서 멀티플렉싱 (MPU9250, 압력센서)

ESP32 설정:
Wire.begin(21, 22);  // SDA=21, SCL=22
Wire.setClock(400000);  // 400kHz
```
### SPI (Serial Peripheral Interface)
```
특징: 4선식 (MOSI, MISO, SCK, CS), 전이중 통신
회로: 각 슬레이브마다 개별 CS 신호 필요
용도: 고속 센서, 메모리 카드

ESP32 설정:
SPI.begin(18, 19, 23);  // SCK, MISO, MOSI
SPI.setClockDivider(SPI_CLOCK_DIV8);  // 10MHz
```

### UART (비동기 직렬)
```
특징: 2선식 (TX, RX), 비동기식 통신
회로: 크로스 연결 (TX-RX, RX-TX)
용도: 디버깅, 외부 모듈 통신

ESP32 설정:
Serial2.begin(115200, SERIAL_8N1, 16, 17);
```

### CAN 버스
```
특징: 차동 신호 (CAN_H, CAN_L), 우선순위 기반
회로: SN65HVD230 트랜시버 + 120Ω 터미네이터
용도: 고신뢰성 모터 제어 통신

ESP32 설정:
CAN.setPins(5, 35);  // TX, RX
CAN.begin(500E3);    // 500kbps
```
### RS-232
```
특징: ±3V~±25V 전압 레벨, 장거리 통신 가능
회로: MAX3232 레벨 변환기 필요
용도: 외부 시스템 연동, 산업용 장비

ESP32 연결:
MCU (3.3V) → MAX3232 → RS-232 커넥터
```

## 📊 프로토콜 설계

### 메시지 구조
```
[STX][LEN][CMD][DATA...][CRC][ETX]
STX: 시작 바이트 (0x02)
LEN: 데이터 길이
CMD: 명령 코드  
DATA: 가변 데이터
CRC: 체크섬
ETX: 종료 바이트 (0x03)
```

## 🌐 무선 통신

### WiFi (ESP32 내장)
```cpp
WiFi.begin("SSID", "password");
WiFiServer server(80);  // TCP 서버
```

### Bluetooth (ESP32 내장)  
```cpp
BluetoothSerial SerialBT;
SerialBT.begin("ESP32-Robot");
```

---

## 🔗 연결 문서
- 상위: [[전자회로설계]]
- 관련: [[마이크로컨트롤러]], [[프로토콜]]
- 응용: [[센서인터페이스]], [[모터드라이버]]