# 멀티플렉서

> 상위: [[전자회로설계]]

다중 센서 신호를 하나의 ADC로 처리하기 위한 멀티플렉서 회로입니다.

## 🔄 아날로그 멀티플렉서

### CD4051 8채널 멀티플렉서
```
센서1 ─┐
센서2 ─┤
센서3 ─┤ CD4051 ─── ADC 입력
센서4 ─┤  MUX
센서5 ─┤
센서6 ─┘

제어신호: A0, A1, A2 (3bit = 8채널)
```

### 회로 연결
```cpp
// ESP32 멀티플렉서 제어
#define MUX_A0 25
#define MUX_A1 26  
#define MUX_A2 27
#define MUX_SIG 34  // ADC 입력

void selectChannel(int channel) {
    digitalWrite(MUX_A0, channel & 0x01);
    digitalWrite(MUX_A1, (channel >> 1) & 0x01);
    digitalWrite(MUX_A2, (channel >> 2) & 0x01);
    delayMicroseconds(10);  // 안정화 시간
}

float readSensor(int channel) {
    selectChannel(channel);
    return analogRead(MUX_SIG) * 3.3 / 4095.0;
}
```
## 🔧 실무 활용 예시

### 로봇 센서 모니터링 시스템
```cpp
// 8개 센서 순차 스캔
typedef struct {
    float temperature[4];  // 온도 센서 4개
    float pressure[2];     // 압력 센서 2개  
    float voltage[2];      // 전압 모니터 2개
} SensorData_t;

void scanAllSensors(SensorData_t* data) {
    // 온도 센서들 (채널 0-3)
    for(int i = 0; i < 4; i++) {
        data->temperature[i] = readSensor(i);
    }
    
    // 압력 센서들 (채널 4-5)
    for(int i = 0; i < 2; i++) {
        data->pressure[i] = readSensor(4 + i);
    }
    
    // 전압 모니터 (채널 6-7)
    for(int i = 0; i < 2; i++) {
        data->voltage[i] = readSensor(6 + i);
    }
}
```

### 고속 멀티플렉싱
```cpp
// DG508A 8채널 고속 MUX (STM32용)
void setupHighSpeedMux() {
    // 3bit 주소 신호 설정
    HAL_GPIO_WritePin(GPIOA, GPIO_PIN_0, GPIO_PIN_RESET);  // A0
    HAL_GPIO_WritePin(GPIOA, GPIO_PIN_1, GPIO_PIN_RESET);  // A1  
    HAL_GPIO_WritePin(GPIOA, GPIO_PIN_2, GPIO_PIN_RESET);  // A2
    HAL_GPIO_WritePin(GPIOA, GPIO_PIN_3, GPIO_PIN_RESET);  // EN
}

// 1MHz 샘플링으로 8채널 스캔
void fastSensorScan() {
    for(int ch = 0; ch < 8; ch++) {
        setMuxChannel(ch);
        HAL_Delay_us(1);  // 1μs 안정화
        HAL_ADC_Start(&hadc1);
        HAL_ADC_PollForConversion(&hadc1, 1);
        sensorData[ch] = HAL_ADC_GetValue(&hadc1);
    }
}
```

## 📊 성능 고려사항

### 스위칭 시간
```
CD4051: ~250ns (일반용)
DG508A: ~85ns (고속용)  
ADG508: ~40ns (초고속용)

안정화 시간:
- 저임피던스 소스: 1-10μs
- 고임피던스 소스: 10-100μs
```

### 크로스토크 및 오프셋
- **크로스토크**: -80dB 이하 (CD4051)
- **온 저항**: 80Ω (CD4051), 4Ω (DG508A)  
- **누설전류**: 1nA 이하

---

## 🔗 연결 문서
- 상위: [[전자회로설계]]
- 관련: [[ADC]], [[센서인터페이스]]
- 응용: [[신호조절]]